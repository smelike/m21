## 继电器 LH-IO404


使用 标准 Modbus-RTU 协议

波特率：9600

正常模式：对继电器给出断开或闭合指令后，继电器作出相应动作，依照指令完成断开或闭合。


功能：

闪开闪闭功能，此功能只能通过发送指令实现。支持单独控制一个通道的延时动作。

	闪闭-继电器处于闭合时，操作继电器断开一段时间（设置参数 \*0.1s）后自动闭合；

	闪开-继电器处于断开时，操作继电器闭合一段时间（设置参数 \* 0.1s）后自动断开；



*** mod: 本机非锁联动模式：

	本身带有光耦输入和继电器输出的模块，在该模式下，输入光耦与继电器为直接联动。
	
	即：光耦输入信号-》对应继电器闭合；光耦输入信号取消-》对应继电器断开。
	
	
	因机械及程序的延迟，光耦输入信号到继电器动作会有一定的延迟，但最大不会超过 0.05秒。
	
	备注：非锁联动模式下，all 继电器直接受光耦联动，所以出现串口无法操作继电器的现象。此并非异常现象，是串口操作继电器后，在继电器还未动作之前，就被光耦的状态联动了。
	（本机非锁联动模式下，光耦状态与继电器的联动，是优先于串口操作的。）


*** mod: 本机自锁联动模式

	该模式适用于外部信号触发，控制设备启停的场景。如：光耦外接一按钮，对应的继电器接用电设备，则每按一次按钮，设备会切换一次启停状态。
	（类似开关的通断，按一次切换自己状态，代表 0 和 1 的变换。不输入，保持不变）
	本带有光耦输入和继电器输出的模块，该模式下，光耦每输入一次信号，对应的继电器翻转一次。即：
	
	 -- 光耦输入信号生效 -》 继电器翻转（闭合变断开、断开变闭合）；
	 -- 光耦输入信号取消 -》 继电器不动作。
	 
	同样存在延迟的问题，delay time \\<= 0.05 s.
	
	
*** mod: 本机互锁模式

	该模式适用于外部信号触发，控制不同设备的启停。如：多路光耦每路接入一个按钮，对应的继电器接入用电设备，则按某路按钮，对应设备启动，其他设备停止运行。
	
	（启动自己，停止其他）
	模块本身带有光耦输入和继电器输出的板卡模块，该模式下，光耦每输入一次信号，对应的继电器会闭合，其他未输入信号光耦对应继电器会断开。即：
	
	-- 光耦输入信号生效-》对应继电器闭合，其他的继电器断开；
	-- 光耦输入信号取消 -》 继电器不动作；
	
	
	delay time \\<= 0.05 s
	
	

双机非锁联动模式、双机自锁联动模式
( LoRa、WiFi 等远程通讯)


*** 硬件规格参数：

 9~28V DC(防反接)
 
 设备功耗(W), 12 V & 24 V 供电-不开 < 0.5;全开 < 3
 
 1 路红色 LED 指示灯

通讯接口：隔离 RS485

通讯协议 标准的 Modbus-RTU

波特率： 2400, 4800, 9600(default), 19200, 38400, 上位机可修改

默认通讯格式：9600,n,8,1

从站地址：0-255, 5 位地址拨码开关可设置 1-31。大于 31 的，可用软件设置


IO 接口：4路 DI(光耦隔离); 4 路 DO

输出触点容量：10A/30V DC 或 10A/250V AC

耐久性：10万次

输出指示：4路红色 LED

工作温度：工业级 -40 ~ 70 摄氏度


*** 地址设置

从站地址 =  拨码地址 + 软件地址。如：拨码设置为 110，软件地址设置为 10，则从站地址为 121.


注意：出厂默认拨码地址为 0，软件地址为 1.


### 报文与控制

FE 05 0000 FF00 9835

FE 从站地址，FE 代表广播地址
05 \05 指令，单个控制指令(1/2/3/5/15) (05 写单个线圈寄存器)
0000 寄存器地址
FF00 控制指令
9835 CRC16 校验和，低位在前
从站地址[2 byte]\指令(单个控制指令)[2bytes]\地址[4bytes]\指令[4bytes]\CRC16[4bytes]

```
1 读线圈寄存器
2 读离散输入寄存器
3 读取参数寄存去，写参数用 06
5 写单个线圈寄存器
15 写多个线圈寄存器


线圈PLC寄存器地址（继电器）：00001 00002 00003 00004
离散量PLC寄存器地址输入（DI）: 10001 10002 10003 10004

波特率 modbus 寄存器地址：03E8H
工作模式 modbus 寄存器地址：03EBH
波特率数值：0~5
```


#### 指令列表

查询四路： FE 01 00 00 00 04 29 C6 - FE 01 01 00 61 9C

DO1 开：FE 05 00 00 FF 00 98 35 - FE 05 00 00 FF 00 98 35
DO1 关: FE 05 00 00 00 00 D9 C5 - FE 05 00 00 00 00 D9 C5

DO2 开：FE 05 00 01 FF 00 C9 F5 - FE 05 00 01 FF 00 C9 F5
DO2 关：FE 05 00 01 00 00 88 05 - FE 05 00 01 00 00 88 05

D03: FE 05 00 02 FF 00 


读 DI1: FE 02 00 00 0 01 AD C5 - FE 02 01 00 91 9C
读 DI2: FE 02 00 01 00 01 FC 05 - FE 02
读 DI3: FE 02 00 02 00 01 0C 05 - 
读 DI4: FE 02 00 03 00 01 5D C5


继电器状态 

	-> 继电器查询: FE 01 00 00 00 04 29C6
	00 00 起始地址，0004 查询数量
	
	返回：FE 01 01 00 61 9C
	
	FE 从站地址，
	01 01 指令（查询错误，返回 0x81），
	01 字节数（返回状态信息的所有字节数），
	00 查询的状态（返回的继电器状态，数据转换成 2 进制，高位在前， 1 表示该通道吸合，0 表示该通道断开）
	
	
光耦输入

	-> 查询光耦: FE 02 00 00 00 04 6D C6
	0000 起始地址，0004 查询数量
	
	返回码：FE 02 01 00 91 9C
	02 返回指令，查询错误，返回 0x82
	01 字节数
	00 返回的光耦状态，转换 2 进制，高位在前，1表示吸合，0 表断开。
	
	
闪开闪闭指令

	-> 闪闭：FE 10 00 03 00 02 (04) [00 04] 00 0A 41 6B
	-> 闪开：FE 10 00 03 00 02 04 [00 02] 00 0A A1 6A
	
	
	00 03 继电器地址，3+5(n-1), n 代表第几个通道，10进制需换算为 16 进制；
	
	00 02 控制的继电器通道数量，2+5(n-1)，n 代表控制的通道数量，仅支持单独控制一个通道的延时动作；
	04 控制内容字节长度，如：0004(闪闭)/0002(闪开)， 4+10(n-1)

	000A 闪开时间 (0.1 * 10)
	
	
	继电器地址： 3 + 5(n-1), n 代表第 1、2、3、4... 通道
	继电器通道数量： 2+5(n-1), n 代表数量，仅支持单独一个，即 n 永远为 1?


	全开全关指令： FE 0F 00 00 00 04 01 FF 31 D2 / FE 0F 00 00 00 04 01 00 71 92

	全断全开返回码： FE 0F 00 00 00 04 40 07


#### 主动上报协议

	非标准 Modbus-RTU 协议，仅在双机模式才可用。适用于串口继电器主动上报变化的开关量。
	
	


	
	
	







 
 
